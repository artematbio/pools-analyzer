-- БЕЗОПАСНАЯ ОЧИСТКА ДУБЛИКАТОВ lp_position_snapshots
-- =====================================================
-- ВАЖНО: Перед выполнением сделайте бэкап таблицы!
-- 
-- CREATE TABLE lp_position_snapshots_backup AS 
-- SELECT * FROM lp_position_snapshots;
-- 
-- Удаляет 971 дублирующихся записей
-- Создан: 2025-08-15T12:15:53.979097

BEGIN;

-- BIO/MYCO (39 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2253', '2218', '2183', '2148', '2113', '2078', '2043', '2008', '1973', '1938', '1903', '1870', '1837', '1804', '1771', '1738', '1715', '1696', '1677', '1658');
DELETE FROM lp_position_snapshots WHERE id IN ('1639', '1620', '1601', '1582', '1563', '1544', '1525', '1506', '1487', '1468', '1449', '1429', '1409', '1389', '1369', '1349', '1329', '1309', '1289');

-- BIO/URO (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2252', '2217', '2182', '2147', '2112', '2077', '2042', '2007', '1972', '1937', '1902', '1869', '1836', '1803', '1770', '1737', '1714', '1695', '1676', '1657');
DELETE FROM lp_position_snapshots WHERE id IN ('1638', '1619', '1600', '1581', '1562', '1543', '1524', '1505', '1486', '1467', '1448', '1428', '1408', '1388', '1368', '1348', '1328', '1308');

-- BIO/RIF (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2251', '2216', '2181', '2146', '2111', '2076', '2041', '2006', '1971', '1936', '1901', '1868', '1835', '1802', '1769', '1736', '1713', '1694', '1675', '1656');
DELETE FROM lp_position_snapshots WHERE id IN ('1637', '1618', '1599', '1580', '1561', '1542', '1523', '1504', '1485', '1466', '1447', '1427', '1407', '1387', '1367', '1347', '1327', '1307');

-- SOL/SPINE (76 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2250', '2215', '2180', '2145', '2110', '2075', '2040', '2005', '1970', '1935', '1900', '1867', '1834', '1801', '1768', '1735', '1712', '1693', '1674', '1655');
DELETE FROM lp_position_snapshots WHERE id IN ('1636', '1617', '1598', '1579', '1560', '1541', '1522', '1503', '1484', '1465', '1445', '1425', '1405', '1385', '1365', '1345', '1325', '1305', '2249', '2214');
DELETE FROM lp_position_snapshots WHERE id IN ('2179', '2144', '2109', '2074', '2039', '2004', '1969', '1934', '1899', '1866', '1833', '1800', '1767', '1734', '1711', '1692', '1673', '1654', '1635', '1616');
DELETE FROM lp_position_snapshots WHERE id IN ('1597', '1578', '1559', '1540', '1521', '1502', '1483', '1464', '1444', '1424', '1404', '1384', '1364', '1344', '1324', '1304');

-- BIO/QBIO (69 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2248', '2213', '2178', '2143', '2108', '2073', '2038', '2003', '1968', '1933', '1898', '1865', '1832', '1799', '1766', '1733', '1710', '1691', '1672', '1653');
DELETE FROM lp_position_snapshots WHERE id IN ('1634', '1615', '1596', '1577', '1558', '1539', '1520', '1501', '1482', '1463', '1443', '1423', '1403', '1383', '1363', '1343', '1323', '1303', '2257', '2225');
DELETE FROM lp_position_snapshots WHERE id IN ('2222', '2190', '2187', '2155', '2152', '2120', '2117', '2085', '2082', '2050', '2047', '2015', '2012', '1980', '1977', '1945', '1942', '1910', '1907', '1877');
DELETE FROM lp_position_snapshots WHERE id IN ('1874', '1844', '1841', '1811', '1808', '1778', '1775', '1745', '1742');

-- SOL/BIO (75 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2247', '2212', '2177', '2142', '2107', '2072', '2037', '2002', '1967', '1932', '1897', '1864', '1831', '1798', '1765', '1732', '1709', '1690', '1671', '1652');
DELETE FROM lp_position_snapshots WHERE id IN ('1633', '1614', '1595', '1576', '1557', '1538', '1519', '1500', '1481', '1462', '1442', '1422', '1402', '1382', '1362', '1342', '1322', '1302', '2246', '2211');
DELETE FROM lp_position_snapshots WHERE id IN ('2176', '2141', '2106', '2071', '2036', '2001', '1966', '1931', '1896', '1863', '1830', '1797', '1764', '1731', '1708', '1689', '1670', '1651', '1632', '1613');
DELETE FROM lp_position_snapshots WHERE id IN ('1594', '1575', '1556', '1537', '1518', '1499', '1480', '1461', '1421', '1401', '1381', '1361', '1341', '1321', '1301');

-- BIO/HAIR (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2245', '2210', '2175', '2140', '2105', '2070', '2035', '2000', '1965', '1930', '1895', '1862', '1829', '1796', '1763', '1730', '1707', '1688', '1669', '1650');
DELETE FROM lp_position_snapshots WHERE id IN ('1631', '1612', '1593', '1574', '1555', '1536', '1517', '1498', '1479', '1460', '1440', '1420', '1400', '1380', '1360', '1340', '1320', '1300');

-- BIO/GROW (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2244', '2209', '2174', '2139', '2104', '2069', '2034', '1999', '1964', '1929', '1894', '1861', '1828', '1795', '1762', '1729', '1706', '1687', '1668', '1649');
DELETE FROM lp_position_snapshots WHERE id IN ('1630', '1611', '1592', '1573', '1554', '1535', '1516', '1497', '1478', '1459', '1439', '1419', '1399', '1379', '1359', '1339', '1319', '1299');

-- BIO/VITA (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2243', '2208', '2173', '2138', '2103', '2068', '2033', '1998', '1963', '1928', '1893', '1860', '1827', '1794', '1761', '1728', '1705', '1686', '1667', '1648');
DELETE FROM lp_position_snapshots WHERE id IN ('1629', '1610', '1591', '1572', '1553', '1534', '1515', '1496', '1477', '1458', '1438', '1418', '1398', '1378', '1358', '1338', '1318', '1298');

-- BIO/PSY (86 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2273', '2242', '2238', '2207', '2203', '2172', '2168', '2137', '2133', '2102', '2098', '2067', '2063', '2032', '2028', '1997', '1993', '1962', '1958', '1927');
DELETE FROM lp_position_snapshots WHERE id IN ('1923', '1892', '1888', '1859', '1855', '1826', '1822', '1793', '1789', '1760', '1756', '1727', '1723', '1704', '1685', '1666', '1647', '1628', '1609', '1590');
DELETE FROM lp_position_snapshots WHERE id IN ('1571', '1552', '1533', '1514', '1495', '1476', '1457', '1437', '1417', '1397', '1377', '1357', '1337', '1317', '1297', '2258', '2226', '2223', '2191', '2188');
DELETE FROM lp_position_snapshots WHERE id IN ('2156', '2153', '2121', '2118', '2086', '2083', '2051', '2048', '2016', '2013', '1981', '1978', '1946', '1943', '1911', '1908', '1878', '1875', '1845', '1842');
DELETE FROM lp_position_snapshots WHERE id IN ('1812', '1809', '1779', '1776', '1746', '1743');

-- BIO/CRYO (86 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2272', '2241', '2237', '2206', '2202', '2171', '2167', '2136', '2132', '2101', '2097', '2066', '2062', '2031', '2027', '1996', '1992', '1961', '1957', '1926');
DELETE FROM lp_position_snapshots WHERE id IN ('1922', '1891', '1887', '1858', '1854', '1825', '1821', '1792', '1788', '1759', '1755', '1726', '1722', '1703', '1684', '1665', '1646', '1627', '1608', '1589');
DELETE FROM lp_position_snapshots WHERE id IN ('1570', '1551', '1532', '1513', '1494', '1475', '1456', '1436', '1416', '1396', '1376', '1356', '1336', '1316', '1296', '2256', '2224', '2221', '2189', '2186');
DELETE FROM lp_position_snapshots WHERE id IN ('2154', '2151', '2119', '2116', '2084', '2081', '2049', '2046', '2014', '2011', '1979', '1976', '1944', '1941', '1909', '1906', '1876', '1873', '1843', '1840');
DELETE FROM lp_position_snapshots WHERE id IN ('1810', '1807', '1777', '1774', '1744', '1741');

-- BIO/NEURON (55 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2271', '2240', '2236', '2205', '2201', '2170', '2166', '2135', '2131', '2100', '2096', '2065', '2061', '2030', '2026', '1995', '1991', '1960', '1956', '1925');
DELETE FROM lp_position_snapshots WHERE id IN ('1921', '1890', '1886', '1857', '1853', '1824', '1820', '1791', '1787', '1758', '1754', '1725', '1721', '1702', '1683', '1664', '1645', '1626', '1607', '1588');
DELETE FROM lp_position_snapshots WHERE id IN ('1569', '1550', '1531', '1512', '1493', '1474', '1455', '1435', '1415', '1395', '1375', '1355', '1335', '1315', '1295');

-- BIO/ATH (55 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2270', '2239', '2235', '2204', '2200', '2169', '2165', '2134', '2130', '2099', '2095', '2064', '2060', '2029', '2025', '1994', '1990', '1959', '1955', '1924');
DELETE FROM lp_position_snapshots WHERE id IN ('1920', '1889', '1885', '1856', '1852', '1823', '1819', '1790', '1786', '1757', '1753', '1724', '1720', '1701', '1682', '1663', '1644', '1625', '1606', '1587');
DELETE FROM lp_position_snapshots WHERE id IN ('1568', '1549', '1530', '1511', '1492', '1473', '1454', '1434', '1414', '1394', '1374', '1354', '1334', '1314', '1294');

-- BIO/WETH (97 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2234', '2199', '2164', '2129', '2094', '2059', '2024', '1989', '1954', '1919', '1884', '1851', '1818', '1785', '1752', '1719', '1700', '1681', '1662', '1643');
DELETE FROM lp_position_snapshots WHERE id IN ('1624', '1605', '1586', '1567', '1548', '1529', '1510', '1491', '1472', '1453', '1433', '1413', '1393', '1373', '1353', '1333', '1313', '1293', '2233', '2198');
DELETE FROM lp_position_snapshots WHERE id IN ('2163', '2128', '2093', '2058', '2023', '1988', '1953', '1918', '1883', '1850', '1817', '1784', '1751', '1718', '1699', '1680', '1661', '1642', '1623', '1604');
DELETE FROM lp_position_snapshots WHERE id IN ('1585', '1566', '1547', '1528', '1509', '1490', '1471', '1452', '1432', '1412', '1392', '1372', '1352', '1332', '1312', '1292', '2266', '2232', '2231', '2197');
DELETE FROM lp_position_snapshots WHERE id IN ('2196', '2162', '2161', '2127', '2126', '2092', '2091', '2057', '2056', '2022', '2021', '1987', '1986', '1952', '1951', '1917', '1916');

-- ATH/BIO (15 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2230', '2195', '2160', '2125', '2090', '2055', '2020', '1985', '1950', '1915', '1882', '1849', '1816', '1783', '1750');

-- GROW/BIO (15 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2229', '2194', '2159', '2124', '2089', '2054', '2019', '1984', '1949', '1914', '1881', '1848', '1815', '1782', '1749');

-- NEURON/BIO (15 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2228', '2193', '2158', '2123', '2088', '2053', '2018', '1983', '1948', '1913', '1880', '1847', '1814', '1781', '1748');

-- HAIR/BIO (15 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2227', '2192', '2157', '2122', '2087', '2052', '2017', '1982', '1947', '1912', '1879', '1846', '1813', '1780', '1747');

-- WETH/BIO (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2220', '2185', '2150', '2115', '2080', '2045', '2010', '1975', '1940', '1905', '1872', '1839', '1806', '1773', '1740', '1717', '1698', '1679', '1660', '1641');
DELETE FROM lp_position_snapshots WHERE id IN ('1622', '1603', '1584', '1565', '1546', '1527', '1508', '1489', '1470', '1451', '1431', '1411', '1391', '1371', '1351', '1331', '1311', '1291');

-- VITA/BIO (38 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('2219', '2184', '2149', '2114', '2079', '2044', '2009', '1974', '1939', '1904', '1871', '1838', '1805', '1772', '1739', '1716', '1697', '1678', '1659', '1640');
DELETE FROM lp_position_snapshots WHERE id IN ('1621', '1602', '1583', '1564', '1545', '1526', '1507', '1488', '1469', '1450', '1430', '1410', '1390', '1370', '1350', '1330', '1310', '1290');

-- BIO/SPINE (7 дубликатов)
DELETE FROM lp_position_snapshots WHERE id IN ('1426', '1406', '1386', '1366', '1346', '1326', '1306');


-- Проверка результата
SELECT 
    COUNT(*) as total_records,
    COUNT(DISTINCT CONCAT(position_mint, '_', network)) as unique_positions
FROM lp_position_snapshots 
WHERE created_at >= NOW() - INTERVAL '7 days';

COMMIT;

-- ROLLBACK; -- Раскомментируйте эту строку вместо COMMIT для отката
